import{l as n,f as s,G as a}from"./framework.dc3bd9a4.js";const e='{"title":"Suspense","description":"","frontmatter":{"id":"suspense","title":"Suspense"},"headers":[{"level":2,"title":"Resetting Error Boundaries","slug":"resetting-error-boundaries"},{"level":2,"title":"Fetch-on-render vs Render-as-you-fetch","slug":"fetch-on-render-vs-render-as-you-fetch"}],"relativePath":"guides/suspense.md","lastUpdated":1610601521825}',t={},o=a('<blockquote><p>NOTE: Suspense mode for Vu Query is experimental, same as Suspense for data fetching itself. These APIs WILL change and should not be used in production unless you lock both your React and Vu Query versions to patch-level versions that are compatible with each other.</p></blockquote><p>Vu Query can also be used with React&#39;s new Suspense for Data Fetching API&#39;s. To enable this mode, you can set either the global or query level config&#39;s <code>suspense</code> option to <code>true</code>.</p><p>Global configuration:</p><div class="language-js"><pre><code><span class="token comment">// Configure for all queries</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> QueryClient<span class="token punctuation">,</span> QueryClientProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vu-query&#39;</span>\n\n<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  defaultOptions<span class="token operator">:</span> <span class="token punctuation">{</span>\n    queries<span class="token operator">:</span> <span class="token punctuation">{</span>\n      suspense<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">function</span> <span class="token function">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>QueryClientProvider client<span class="token operator">=</span><span class="token punctuation">{</span>queryClient<span class="token punctuation">}</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>QueryClientProvider<span class="token operator">&gt;</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>Query configuration:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vu-query&#39;</span>\n\n<span class="token comment">// Enable for an individual query</span>\n<span class="token function">useQuery</span><span class="token punctuation">(</span>queryKey<span class="token punctuation">,</span> queryFn<span class="token punctuation">,</span> <span class="token punctuation">{</span> suspense<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><p>When using suspense mode, <code>status</code> states and <code>error</code> objects are not needed and are then replaced by usage of the <code>React.Suspense</code> component (including the use of the <code>fallback</code> prop and React error boundaries for catching errors). Please read the <a href="#resetting-error-boundaries">Resetting Error Boundaries</a> and look at the <a href="https://codesandbox.io/s/github/tannerlinsley/react-query/tree/master/examples/suspense" target="_blank" rel="noopener noreferrer">Suspense Example</a> for more information on how to set up suspense mode.</p><p>In addition to queries behaving differently in suspense mode, mutations also behave a bit differently. By default, instead of supplying the <code>error</code> variable when a mutation fails, it will be thrown during the next render of the component it&#39;s used in and propagate to the nearest error boundary, similar to query errors. If you wish to disable this, you can set the <code>useErrorBoundary</code> option to <code>false</code>. If you wish that errors are not thrown at all, you can set the <code>throwOnError</code> option to <code>false</code> as well!</p><h2 id="resetting-error-boundaries"><a class="header-anchor" href="#resetting-error-boundaries" aria-hidden="true">#</a> Resetting Error Boundaries</h2><p>Whether you are using <strong>suspense</strong> or <strong>useErrorBoundaries</strong> in your queries, you will need a way to let queries know that you want to try again when re-rendering after some error occured.</p><p>Query errors can be reset with the <code>QueryErrorResetBoundary</code> component or with the <code>useQueryErrorResetBoundary</code> hook.</p><p>When using the component it will reset any query errors within the boundaries of the component:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> QueryErrorResetBoundary <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vu-query&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ErrorBoundary <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-error-boundary&#39;</span>\n\n<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>QueryErrorResetBoundary<span class="token operator">&gt;</span>\n    <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> reset <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>ErrorBoundary\n        onReset<span class="token operator">=</span><span class="token punctuation">{</span>reset<span class="token punctuation">}</span>\n        fallbackRender<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> resetErrorBoundary <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n          <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>\n            There was an error<span class="token operator">!</span>\n            <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resetErrorBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Try again<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>\n          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n        <span class="token punctuation">)</span><span class="token punctuation">}</span>\n      <span class="token operator">&gt;</span>\n        <span class="token operator">&lt;</span>Page <span class="token operator">/</span><span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">&gt;</span>\n    <span class="token punctuation">)</span><span class="token punctuation">}</span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>QueryErrorResetBoundary<span class="token operator">&gt;</span>\n<span class="token punctuation">)</span>\n</code></pre></div><p>When using the hook it will reset any query errors within the closest <code>QueryErrorResetBoundary</code>. If there is no boundary defined it will reset them globally:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useQueryErrorResetBoundary <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vu-query&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ErrorBoundary <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-error-boundary&#39;</span>\n\n<span class="token keyword">const</span> App<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> reset <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQueryErrorResetBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>ErrorBoundary\n      onReset<span class="token operator">=</span><span class="token punctuation">{</span>reset<span class="token punctuation">}</span>\n      fallbackRender<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> resetErrorBoundary <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>\n          There was an error<span class="token operator">!</span>\n          <span class="token operator">&lt;</span>Button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resetErrorBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Try again<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n      <span class="token punctuation">)</span><span class="token punctuation">}</span>\n    <span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>Page <span class="token operator">/</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">&gt;</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="fetch-on-render-vs-render-as-you-fetch"><a class="header-anchor" href="#fetch-on-render-vs-render-as-you-fetch" aria-hidden="true">#</a> Fetch-on-render vs Render-as-you-fetch</h2><p>Out of the box, Vu Query in <code>suspense</code> mode works really well as a <strong>Fetch-on-render</strong> solution with no additional configuration. This means that when your components attempt to mount, they will trigger query fetching and suspend, but only once you have imported them and mounted them. If you want to take it to the next level and implement a <strong>Render-as-you-fetch</strong> model, we recommend implementing <a href="./prefetching.html">Prefetching</a> on routing callbacks and/or user interactions events to start loading queries before they are mounted and hopefully even before you start importing or mounting their parent components.</p>',17);t.render=function(a,e,t,p,r,c){return n(),s("div",null,[o])};export default t;export{e as __pageData};
