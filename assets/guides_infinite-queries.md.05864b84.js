import{l as n,f as a,G as s}from"./framework.dc3bd9a4.js";const t='{"title":"Infinite Queries","description":"","frontmatter":{"id":"infinite-queries","title":"Infinite Queries"},"headers":[{"level":2,"title":"Example","slug":"example"},{"level":2,"title":"What happens when an infinite query needs to be refetched?","slug":"what-happens-when-an-infinite-query-needs-to-be-refetched"},{"level":2,"title":"What if I need to pass custom information to my query function?","slug":"what-if-i-need-to-pass-custom-information-to-my-query-function"},{"level":2,"title":"What if I want to implement a bi-directional infinite list?","slug":"what-if-i-want-to-implement-a-bi-directional-infinite-list"},{"level":2,"title":"What if I want to show the pages in reversed order?","slug":"what-if-i-want-to-show-the-pages-in-reversed-order"},{"level":2,"title":"What if I want to manually update the infinite query?","slug":"what-if-i-want-to-manually-update-the-infinite-query"}],"relativePath":"guides/infinite-queries.md","lastUpdated":1610594008257}',e={},o=s('<p>Rendering lists that can additively &quot;load more&quot; data onto an existing set of data or &quot;infinite scroll&quot; is also a very common UI pattern. Vu Query supports a useful version of <code>useQuery</code> called <code>useInfiniteQuery</code> for querying these types of lists.</p><p>When using <code>useInfiniteQuery</code>, you&#39;ll notice a few things are different:</p><ul><li><code>data</code> is now an object containing infinite query data:</li><li><code>data.pages</code> array containing the fetched pages</li><li><code>data.pageParams</code> array containing the page params used to fetch the pages</li><li>The <code>fetchNextPage</code> and <code>fetchPreviousPage</code> functions are now available</li><li>The <code>getNextPageParam</code> and <code>getPreviousPageParam</code> options are available for both determining if there is more data to load and the information to fetch it. This information is supplied as an additional parameter in the query function (which can optionally be overridden when calling the <code>fetchNextPage</code> or <code>fetchPreviousPage</code> functions)</li><li>A <code>hasNextPage</code> boolean is now available and is <code>true</code> if <code>getNextPageParam</code> returns a value other than <code>undefined</code>.</li><li>A <code>hasPreviousPage</code> boolean is now available and is <code>true</code> if <code>getPreviousPageParam</code> returns a value other than <code>undefined</code>.</li><li>The <code>isFetchingNextPage</code> and <code>isFetchingPreviousPage</code> booleans are now available to distinguish between a background refresh state and a loading more state</li></ul><h2 id="example"><a class="header-anchor" href="#example" aria-hidden="true">#</a> Example</h2><p>Let&#39;s assume we have an API that returns pages of <code>projects</code> 3 at a time based on a <code>cursor</code> index along with a cursor that can be used to fetch the next group of projects:</p><div class="language-js"><pre><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/projects?cursor=0&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// { data: [...], nextCursor: 3}</span>\n<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/projects?cursor=3&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// { data: [...], nextCursor: 6}</span>\n<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/projects?cursor=6&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// { data: [...], nextCursor: 9}</span>\n<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/projects?cursor=9&#39;</span><span class="token punctuation">)</span>\n<span class="token comment">// { data: [...] }</span>\n</code></pre></div><p>With this information, we can create a &quot;Load More&quot; UI by:</p><ul><li>Waiting for <code>useInfiniteQuery</code> to request the first group of data by default</li><li>Returning the information for the next query in <code>getNextPageParam</code></li><li>Calling <code>fetchNextPage</code> function</li></ul><blockquote><p>Note: It&#39;s very important you do not call <code>fetchNextPage</code> with arguments unless you want them to override the <code>pageParam</code> data returned from the <code>getNextPageParam</code> function. eg. Do not do this: <code>&lt;button onClick={fetchNextPage} /&gt;</code> as this would send the onClick event to the <code>fetchNextPage</code> function.</p></blockquote><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useInfiniteQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vu-query&#39;</span>\n\n<span class="token keyword">function</span> <span class="token function">Projects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">fetchProjects</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> pageParam <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>\n    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/projects?cursor=&#39;</span> <span class="token operator">+</span> pageParam<span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n    data<span class="token punctuation">,</span>\n    error<span class="token punctuation">,</span>\n    fetchNextPage<span class="token punctuation">,</span>\n    hasNextPage<span class="token punctuation">,</span>\n    isFetching<span class="token punctuation">,</span>\n    isFetchingNextPage<span class="token punctuation">,</span>\n    status<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span><span class="token string">&#39;projects&#39;</span><span class="token punctuation">,</span> fetchProjects<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">getNextPageParam</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">lastPage<span class="token punctuation">,</span> pages</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> lastPage<span class="token punctuation">.</span>nextCursor<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> status <span class="token operator">===</span> <span class="token string">&#39;loading&#39;</span> <span class="token operator">?</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>\n  <span class="token punctuation">)</span> <span class="token operator">:</span> status <span class="token operator">===</span> <span class="token string">&#39;error&#39;</span> <span class="token operator">?</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Error<span class="token operator">:</span> <span class="token punctuation">{</span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>\n  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>\n      <span class="token punctuation">{</span>data<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">group<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n        <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token operator">&gt;</span>\n          <span class="token punctuation">{</span>group<span class="token punctuation">.</span>projects<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">project</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\n            <span class="token operator">&lt;</span>p key<span class="token operator">=</span><span class="token punctuation">{</span>project<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>project<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>\n          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>\n      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>\n        <span class="token operator">&lt;</span>button\n          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetchNextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n          disabled<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">!</span>hasNextPage <span class="token operator">||</span> isFetchingNextPage<span class="token punctuation">}</span>\n        <span class="token operator">&gt;</span>\n          <span class="token punctuation">{</span>isFetchingNextPage\n            <span class="token operator">?</span> <span class="token string">&#39;Loading more...&#39;</span>\n            <span class="token operator">:</span> hasNextPage\n            <span class="token operator">?</span> <span class="token string">&#39;Load More&#39;</span>\n            <span class="token operator">:</span> <span class="token string">&#39;Nothing more to load&#39;</span><span class="token punctuation">}</span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>isFetching <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isFetchingNextPage <span class="token operator">?</span> <span class="token string">&#39;Fetching...&#39;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="what-happens-when-an-infinite-query-needs-to-be-refetched"><a class="header-anchor" href="#what-happens-when-an-infinite-query-needs-to-be-refetched" aria-hidden="true">#</a> What happens when an infinite query needs to be refetched?</h2><p>When an infinite query becomes <code>stale</code> and needs to be refetched, each group is fetched <code>sequentially</code>, starting from the first one. This ensures that even if the underlying data is mutated we&#39;re not using stale cursors and potentially getting duplicates or skipping records. If an infinite query&#39;s results are ever removed from the queryCache, the pagination restarts at the initial state with only the initial group being requested.</p><h2 id="what-if-i-need-to-pass-custom-information-to-my-query-function"><a class="header-anchor" href="#what-if-i-need-to-pass-custom-information-to-my-query-function" aria-hidden="true">#</a> What if I need to pass custom information to my query function?</h2><p>By default, the variable returned from <code>getNextPageParam</code> will be supplied to the query function, but in some cases, you may want to override this. You can pass custom variables to the <code>fetchNextPage</code> function which will override the default variable like so:</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">Projects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">fetchProjects</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> pageParam <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>\n    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;/api/projects?cursor=&#39;</span> <span class="token operator">+</span> pageParam<span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n    status<span class="token punctuation">,</span>\n    data<span class="token punctuation">,</span>\n    isFetching<span class="token punctuation">,</span>\n    isFetchingNextPage<span class="token punctuation">,</span>\n    fetchNextPage<span class="token punctuation">,</span>\n    hasNextPage<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span><span class="token string">&#39;projects&#39;</span><span class="token punctuation">,</span> fetchProjects<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">getNextPageParam</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">lastPage<span class="token punctuation">,</span> pages</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> lastPage<span class="token punctuation">.</span>nextCursor<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token comment">// Pass your own page param</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">skipToCursor50</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetchNextPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pageParam<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="what-if-i-want-to-implement-a-bi-directional-infinite-list"><a class="header-anchor" href="#what-if-i-want-to-implement-a-bi-directional-infinite-list" aria-hidden="true">#</a> What if I want to implement a bi-directional infinite list?</h2><p>Bi-directional lists can be implemented by using the <code>getPreviousPageParam</code>, <code>fetchPreviousPage</code>, <code>hasPreviousPage</code> and <code>isFetchingPreviousPage</code> properties and functions.</p><div class="language-js"><pre><code><span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span><span class="token string">&#39;projects&#39;</span><span class="token punctuation">,</span> fetchProjects<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">getNextPageParam</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">lastPage<span class="token punctuation">,</span> pages</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> lastPage<span class="token punctuation">.</span>nextCursor<span class="token punctuation">,</span>\n  <span class="token function-variable function">getPreviousPageParam</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">firstPage<span class="token punctuation">,</span> pages</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> firstPage<span class="token punctuation">.</span>prevCursor<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><h2 id="what-if-i-want-to-show-the-pages-in-reversed-order"><a class="header-anchor" href="#what-if-i-want-to-show-the-pages-in-reversed-order" aria-hidden="true">#</a> What if I want to show the pages in reversed order?</h2><p>Sometimes you may want to show the pages in reversed order. If this is case, you can use the <code>select</code> option:</p><div class="language-js"><pre><code><span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span><span class="token string">&#39;projects&#39;</span><span class="token punctuation">,</span> fetchProjects<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">select</span><span class="token operator">:</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n    pages<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>data<span class="token punctuation">.</span>pages<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    pageParams<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>data<span class="token punctuation">.</span>pageParams<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><h2 id="what-if-i-want-to-manually-update-the-infinite-query"><a class="header-anchor" href="#what-if-i-want-to-manually-update-the-infinite-query" aria-hidden="true">#</a> What if I want to manually update the infinite query?</h2><p>Manually removing first page:</p><div class="language-js"><pre><code>queryClient<span class="token punctuation">.</span><span class="token function">setQueryData</span><span class="token punctuation">(</span><span class="token string">&#39;projects&#39;</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n  pages<span class="token operator">:</span> data<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  pageParams<span class="token operator">:</span> data<span class="token punctuation">.</span>pageParams<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre></div>',24);e.render=function(s,t,e,p,c,i){return n(),a("div",null,[o])};export default e;export{t as __pageData};
